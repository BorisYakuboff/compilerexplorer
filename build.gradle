plugins {
    id 'java'
    id 'org.jetbrains.intellij' version '0.3.7'
    id "de.undercouch.download" version "3.4.2"
}

group 'com.compilerexplorer'
version '1.3-SNAPSHOT'

patchPluginXml {
    changeNotes """
      First minimally working version
    """
}

sourceCompatibility = 1.8

def clionVersion = '2018.1.6'

repositories {
    jcenter()
    mavenCentral()
}

dependencies {
    testCompile group: 'junit', name: 'junit', version: '4.12'
}

intellij {
    localPath = '.gradle/ide/win/clion-' + clionVersion
    updateSinceUntilBuild = false // Disables updating since-build attribute in plugin.xml
}

task setupClion() {
    if (!new File('.gradle/ide/win/clion-' + clionVersion).exists()) {
        download {
            src 'https://download.jetbrains.com/cpp/CLion-' + clionVersion + '.zip'
            dest '.gradle/downloads/clion.zip'
        }
        copy {
            from zipTree('.gradle/downloads/clion.zip')
            into '.gradle/ide/win/clion-' + clionVersion
        }
    }
}

compileJava.dependsOn('setupClion')

publishPlugin {
    username intellijPublishUsername
    password intellijPublishPassword
}

runIde {
    jvmArgs = ['-Xms2048m', '-Xmx8192m']
}
